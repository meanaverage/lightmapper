<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LightMapper CAD</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.4.47/css/materialdesignicons.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/panels.css">
    <link rel="stylesheet" href="css/settings-panel.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/accordion-panels.css">
    <link rel="stylesheet" href="css/figma-theme.css">
    <!-- <link rel="stylesheet" href="css/debug-scroll.css"> -->
    <style>
        /* Notification Badge */
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            min-width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid var(--bg-color);
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header-btn {
            position: relative;
            overflow: visible;
        }

        /* Notification Panel */
        .notification-panel {
            position: fixed;
            top: 60px;
            right: 20px;
            width: 400px;
            max-height: 500px;
            background: var(--bg-color);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            overflow: hidden;
            display: none;
            backdrop-filter: blur(10px);
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: var(--header-bg);
            border-bottom: 1px solid var(--border-color);
        }

        .notification-header h3 {
            margin: 0;
            color: var(--text-color);
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notification-actions {
            display: flex;
            gap: 8px;
        }

        .notification-btn {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            padding: 5px 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .notification-btn:hover {
            background: var(--hover-bg);
        }

        .notification-body {
            max-height: 400px;
            overflow-y: auto;
            padding: 0;
        }

        .notification-empty {
            padding: 40px 20px;
            text-align: center;
            color: var(--text-secondary);
        }

        .notification-empty i {
            font-size: 32px;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        .notification-item {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            align-items: flex-start;
            gap: 10px;
            transition: background-color 0.2s;
        }

        .notification-item:hover {
            background: var(--hover-bg);
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-icon {
            flex-shrink: 0;
            width: 20px;
            text-align: center;
            margin-top: 2px;
        }

        .notification-icon.success { color: #4CAF50; }
        .notification-icon.error { color: #f44336; }
        .notification-icon.warning { color: #ff9800; }
        .notification-icon.info { color: #2196F3; }

        .notification-content {
            flex: 1;
            min-width: 0;
        }

        .notification-message {
            color: var(--text-color);
            margin: 0 0 4px 0;
            word-wrap: break-word;
        }

        .notification-time {
            color: var(--text-secondary);
            font-size: 11px;
        }

        .notification-delete {
            flex-shrink: 0;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 3px;
            opacity: 0;
            transition: opacity 0.2s, background-color 0.2s;
        }

        .notification-item:hover .notification-delete {
            opacity: 1;
        }

        .notification-delete:hover {
            background: var(--hover-bg);
            color: var(--text-color);
        }

        /* Dark theme adjustments */
        [data-theme="dark"] .notification-panel {
            --bg-color: rgba(42, 42, 42, 0.98);
            --header-bg: rgba(51, 51, 51, 0.98);
            --border-color: #667eea;
            --border-light: #555;
            --text-color: #ffffff;
            --text-secondary: #aaa;
            --hover-bg: rgba(255, 255, 255, 0.1);
            background: rgba(42, 42, 42, 0.98) !important;
        }

        /* Light theme adjustments */
        [data-theme="light"] .notification-panel {
            --bg-color: rgba(255, 255, 255, 0.98);
            --header-bg: rgba(248, 249, 250, 0.98);
            --border-color: #667eea;
            --border-light: #e9ecef;
            --text-color: #333333;
            --text-secondary: #666666;
            --hover-bg: rgba(0, 0, 0, 0.05);
            background: rgba(255, 255, 255, 0.98) !important;
        }

        /* Default (fallback) theme - solid background */
        .notification-panel {
            --bg-color: rgba(255, 255, 255, 0.98);
            --header-bg: rgba(248, 249, 250, 0.98);
            --border-color: #667eea;
            --border-light: #e9ecef;
            --text-color: #333333;
            --text-secondary: #666666;
            --hover-bg: rgba(0, 0, 0, 0.05);
            background: rgba(255, 255, 255, 0.98) !important;
        }
    </style>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22><path fill=%22%23ffd700%22 d=%22M12,2A7,7 0 0,0 5,9C5,11.38 6.19,13.47 8,14.74V17A1,1 0 0,0 9,18H15A1,1 0 0,0 16,17V14.74C17.81,13.47 19,11.38 19,9A7,7 0 0,0 12,2M9,21A1,1 0 0,0 10,22H14A1,1 0 0,0 15,21V20H9V21Z%22/></svg>">
</head>
<body>
    <div class="cad-interface">
        <!-- Application Header -->
        <header class="cad-header">
            <div class="app-title">
                <i class="fas fa-lightbulb"></i>
                <span>LightMapper CAD</span>
            </div>
            <div class="header-actions">
                <button class="header-btn" id="refreshBtn" title="Refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="header-btn" id="settingsBtn" title="Settings">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="header-btn" id="notificationBtn" title="Notification History">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                </button>
            </div>
        </header>

        <!-- Notification Panel -->
        <div class="notification-panel" id="notificationPanel">
            <div class="notification-header">
                <h3>
                    <i class="fas fa-bell"></i>
                    Notification History
                </h3>
                <div class="notification-actions">
                    <button class="notification-btn" id="clearNotifications" title="Clear All">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button class="notification-btn" id="closeNotifications" title="Close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="notification-body" id="notificationHistory">
                <div class="notification-empty">
                    <i class="fas fa-bell-slash"></i>
                    <p>No notifications yet</p>
                </div>
            </div>
        </div>

        <!-- Ribbon Toolbar -->
        <div class="ribbon-container">
            <div class="ribbon-tabs">
                <button class="ribbon-tab active" data-tab="home">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </button>
                <button class="ribbon-tab" data-tab="insert">
                    <i class="fas fa-plus"></i>
                    <span>Insert</span>
                </button>
                <button class="ribbon-tab" data-tab="modify">
                    <i class="fas fa-edit"></i>
                    <span>Modify</span>
                </button>
                <button class="ribbon-tab" data-tab="view">
                    <i class="fas fa-eye"></i>
                    <span>View</span>
                </button>
                <button class="ribbon-tab" data-tab="scenes">
                    <i class="fas fa-palette"></i>
                    <span>Scenes</span>
                </button>
            </div>
            
            <div class="ribbon-content">
                <!-- Home Tab -->
                <div class="ribbon-panel active" data-panel="home">
                    <div class="ribbon-group">
                        <div class="ribbon-group-title">Area</div>
                        <div class="ribbon-tools ribbon-tools-vertical">
                            <div class="area-selector">
                                <select id="areaSelector" class="area-dropdown" title="Select Home Assistant Area">
                                    <option value="">Loading areas...</option>
                                </select>
                            </div>
                            <div class="area-actions">
                                <button class="ribbon-tool-small" id="save-floorplan-btn" title="Save Floorplan">
                                    <i class="fas fa-save"></i>
                                    <span>Save</span>
                                </button>
                                <button class="ribbon-tool-small" id="load-floorplan-btn" title="Load Floorplan">
                                    <i class="fas fa-folder-open"></i>
                                    <span>Load</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ribbon-group">
                        <div class="ribbon-group-title">Select</div>
                        <div class="ribbon-tools">
                            <button class="ribbon-tool active" id="select-tool" title="Select Objects">
                                <i class="fas fa-mouse-pointer"></i>
                                <span>Select</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="ribbon-group">
                        <div class="ribbon-group-title">Draw</div>
                        <div class="ribbon-tools">
                            <button class="ribbon-tool" id="room-tool" title="Draw Room">
                                <i class="fas fa-draw-polygon"></i>
                                <span>Room</span>
                            </button>
                            <button class="ribbon-tool" id="line-tool" title="Draw Line">
                                <i class="fas fa-slash"></i>
                                <span>Line</span>
                            </button>
                            <button class="ribbon-tool" id="text-tool" title="Add Text">
                                <i class="fas fa-font"></i>
                                <span>Text</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="ribbon-group">
                        <div class="ribbon-group-title">Import</div>
                        <div class="ribbon-tools">
                            <button class="ribbon-tool" id="import-svg-bg" title="Import SVG as Background">
                                <i class="fas fa-file-image"></i>
                                <span>SVG Bg</span>
                            </button>
                            <button class="ribbon-tool" id="import-svg-rooms" title="Import SVG as Rooms">
                                <i class="fas fa-vector-square"></i>
                                <span>SVG→Rooms</span>
                            </button>
                            <button class="ribbon-tool" id="import-obj-3d" title="Import OBJ 3D Model">
                                <i class="fas fa-cube"></i>
                                <span>OBJ Model</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="ribbon-group">
                        <div class="ribbon-group-title">Lights</div>
                        <div class="ribbon-tools">
                            <button class="ribbon-tool" id="light-tool" title="Add Light">
                                <i class="fas fa-lightbulb"></i>
                                <span>Light</span>
                            </button>
                            <button class="ribbon-tool" id="light-style-btn" title="Light Style">
                                <i class="fas fa-palette"></i>
                                <span>Style</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="ribbon-group">
                        <div class="ribbon-group-title">View</div>
                        <div class="ribbon-tools">
                            <button class="ribbon-tool" id="zoom-in-btn" title="Zoom In">
                                <i class="fas fa-search-plus"></i>
                                <span>Zoom In</span>
                            </button>
                            <button class="ribbon-tool" id="zoom-out-btn" title="Zoom Out">
                                <i class="fas fa-search-minus"></i>
                                <span>Zoom Out</span>
                            </button>
                            <button class="ribbon-tool" id="fit-screen-btn" title="Fit Screen">
                                <i class="fas fa-expand-arrows-alt"></i>
                                <span>Fit</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Insert Tab -->
                <div class="ribbon-panel" data-panel="insert">
                    <div class="ribbon-group">
                        <div class="ribbon-group-title">Objects</div>
                        <div class="ribbon-tools">
                            <button class="ribbon-tool" id="background-tool" title="Background Image">
                                <i class="fas fa-image"></i>
                                <span>Background</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="ribbon-group">
                        <div class="ribbon-group-title">Labels</div>
                        <div class="ribbon-tools">
                            <button class="ribbon-tool" id="ip-labels-btn" title="Show IP Address Labels">
                                <i class="fas fa-network-wired"></i>
                                <span>IP Labels</span>
                            </button>
                            <button class="ribbon-tool" id="hostname-labels-btn" title="Show Hostname Labels">
                                <i class="fas fa-server"></i>
                                <span>Hostnames</span>
                            </button>
                            <button class="ribbon-tool" id="mac-labels-btn" title="Show MAC Address Labels">
                                <i class="fas fa-ethernet"></i>
                                <span>MAC Labels</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Modify Tab -->
                <div class="ribbon-panel" data-panel="modify">
                    <div class="ribbon-group">
                        <div class="ribbon-group-title">Edit</div>
                        <div class="ribbon-tools">
                            <button class="ribbon-tool" id="rotate-btn" title="Rotate">
                                <i class="fas fa-redo"></i>
                                <span>Rotate</span>
                            </button>
                            <button class="ribbon-tool" id="delete-btn" title="Delete">
                                <i class="fas fa-trash"></i>
                                <span>Delete</span>
                            </button>
                            <button class="ribbon-tool" id="clear-canvas-btn" title="Clear Canvas">
                                <i class="fas fa-eraser"></i>
                                <span>Clear All</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="ribbon-group">
                        <div class="ribbon-group-title">Order</div>
                        <div class="ribbon-tools">
                            <button class="ribbon-tool" id="bring-to-front-btn" title="Bring to Front">
                                <i class="fas fa-angle-double-up"></i>
                                <span>To Front</span>
                            </button>
                            <button class="ribbon-tool" id="bring-forward-btn" title="Bring Forward">
                                <i class="fas fa-angle-up"></i>
                                <span>Forward</span>
                            </button>
                            <button class="ribbon-tool" id="send-backward-btn" title="Send Backward">
                                <i class="fas fa-angle-down"></i>
                                <span>Backward</span>
                            </button>
                            <button class="ribbon-tool" id="send-to-back-btn" title="Send to Back">
                                <i class="fas fa-angle-double-down"></i>
                                <span>To Back</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- View Tab -->
                <div class="ribbon-panel" data-panel="view">
                    <div class="ribbon-group">
                        <div class="ribbon-group-title">Display</div>
                        <div class="ribbon-tools">
                            <button class="ribbon-tool active" id="grid-toggle-btn" title="Grid">
                                <i class="fas fa-th"></i>
                                <span>Grid</span>
                            </button>
                            <button class="ribbon-tool active" id="snap-toggle-btn" title="Snap">
                                <i class="fas fa-magnet"></i>
                                <span>Snap</span>
                            </button>
                            <button class="ribbon-tool active" id="labels-toggle-btn" title="Labels">
                                <i class="fas fa-tag"></i>
                                <span>Labels</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="ribbon-group">
                        <div class="ribbon-group-title">Mode</div>
                        <div class="ribbon-tools">
                            <button class="ribbon-tool active" id="state-mode-toggle-btn" title="Current State">
                                <i class="fas fa-home"></i>
                                <span>Current</span>
                            </button>
                            <button class="ribbon-tool" id="theme-toggle-btn" title="Theme">
                                <i class="fas fa-sun"></i>
                                <span>Light</span>
                            </button>
                            <button class="ribbon-tool" id="preview3d-toggle-btn" title="3D Preview">
                                <i class="fas fa-cube"></i>
                                <span>3D View</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Scenes Tab -->
                <div class="ribbon-panel" data-panel="scenes">
                    <div class="ribbon-group">
                        <div class="ribbon-group-title">Scene Actions</div>
                        <div class="ribbon-tools">
                            <button class="ribbon-tool" id="saveScene" title="Save Scene">
                                <i class="fas fa-save"></i>
                                <span>Save</span>
                            </button>
                            <button class="ribbon-tool" id="applyScene" title="Apply Scene">
                                <i class="fas fa-play"></i>
                                <span>Apply</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="ribbon-group">
                        <div class="ribbon-group-title">Layout</div>
                        <div class="ribbon-tools">
                            <button class="ribbon-tool" id="save-layout-btn" title="Save Layout">
                                <i class="fas fa-save"></i>
                                <span>Save</span>
                            </button>
                            <button class="ribbon-tool" id="load-layout-btn" title="Load Layout">
                                <i class="fas fa-folder-open"></i>
                                <span>Load</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Interface with Dock System -->
        <div class="main-interface">
            <!-- Dock Left Container -->
            <div class="dock-left" id="dockLeft">
                <!-- Left Panel -->
                <div class="left-panel">
                    <div class="panel-accordion">
                        <!-- Lights Panel -->
                        <div class="panel-accordion-item" data-panel="lights">
                            <div class="panel-accordion-header active" data-panel="lights">
                                <i class="fas fa-lightbulb"></i>
                                <span>Lights</span>
                                <i class="fas fa-chevron-up accordion-chevron"></i>
                            </div>
                            <div class="panel-accordion-content expanded" id="lightsPanel">
                                <!-- Content will be rendered by LightsPanel -->
                            </div>
                        </div>
                        
                        <!-- Layers Panel -->
                        <div class="panel-accordion-item" data-panel="layers">
                            <div class="panel-accordion-header" data-panel="layers">
                                <i class="fas fa-layer-group"></i>
                                <span>Layers</span>
                                <i class="fas fa-chevron-down accordion-chevron"></i>
                            </div>
                            <div class="panel-accordion-content" id="layersPanel">
                                <!-- Content will be rendered by LayersPanel -->
                            </div>
                        </div>
                        
                        <!-- Debug Panel -->
                        <div class="panel-accordion-item" data-panel="debug">
                            <div class="panel-accordion-header" data-panel="debug">
                                <i class="fas fa-bug"></i>
                                <span>Debug</span>
                                <i class="fas fa-chevron-down accordion-chevron"></i>
                            </div>
                            <div class="panel-accordion-content" id="debugPanel">
                                <!-- Content will be rendered by DebugPanel -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Draggable divider for left panel resize -->
            <div class="vertical-divider" id="leftDivider"></div>

            <!-- Dock Center Container -->
            <div class="dock-center" id="dockCenter">
                <!-- Drawing Area -->
                <div class="drawing-area" id="canvas-container">
                    <div class="canvas-container">
                        <canvas id="floorplan-canvas"></canvas>
                    </div>
                    
                    <!-- Selected Light Indicator -->
                    <div id="selectedLightIndicator" class="selected-light-indicator">
                        <span class="indicator-icon">•</span>
                        <span class="indicator-text">Selected: <strong id="selectedLightName">None</strong></span>
                    </div>
                </div>

            </div>

            <!-- Draggable divider for tertiary panel resize -->
            <div class="vertical-divider" id="tertiaryDivider"></div>

            <!-- Dock Tertiary Container -->
            <div class="dock-tertiary" id="dockTertiary">
                <!-- Tertiary Panel -->
                <div class="tertiary-panel" id="tertiaryPanel">
                    <div class="panel-accordion">
                        <!-- Entities Panel -->
                        <div class="panel-accordion-item" data-panel="entities">
                            <div class="panel-accordion-header active" data-panel="entities">
                                <i class="fas fa-lightbulb"></i>
                                <span>Entities</span>
                                <button class="tertiary-collapse-btn" id="tertiaryCollapseToggle" title="Collapse Panel">
                                    <i class="fas fa-angle-double-right"></i>
                                </button>
                            </div>
                            <div class="panel-accordion-content expanded" id="entitiesPanel">
                                <!-- Content will be rendered by EntitiesPanel -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Draggable divider for right panel resize -->
            <div class="vertical-divider" id="rightDivider"></div>

            <!-- Dock Right Container -->
            <div class="dock-right" id="dockRight">
                <!-- Right Panel -->
                <div class="right-panel" id="rightPanel">
                    <div class="panel-accordion">
                        <!-- Properties Panel -->
                        <div class="panel-accordion-item" data-panel="properties">
                            <div class="panel-accordion-header active" data-panel="properties">
                                <i class="fas fa-sliders-h"></i>
                                <span>Properties</span>
                                <i class="fas fa-chevron-up accordion-chevron"></i>
                            </div>
                            <div class="panel-accordion-content expanded" id="propertiesPanel">
                                <!-- Content will be rendered by PropertiesPanel -->
                            </div>
                        </div>
                        
                        <!-- Scenes Panel -->
                        <div class="panel-accordion-item" data-panel="scenes">
                            <div class="panel-accordion-header" data-panel="scenes">
                                <i class="fas fa-palette"></i>
                                <span>Scenes</span>
                                <i class="fas fa-chevron-down accordion-chevron"></i>
                            </div>
                            <div class="panel-accordion-content" id="scenesPanel">
                                <!-- Content will be rendered by ScenesPanel -->
                            </div>
                        </div>
                        
                        <!-- Scene Editor Panel -->
                        <div class="panel-accordion-item" data-panel="sceneEditor">
                            <div class="panel-accordion-header" data-panel="sceneEditor">
                                <i class="fas fa-edit"></i>
                                <span>Editor</span>
                                <i class="fas fa-chevron-down accordion-chevron"></i>
                            </div>
                            <div class="panel-accordion-content" id="sceneEditorPanel">
                                <!-- Content will be rendered by SceneEditorPanel -->
                            </div>
                        </div>
                        
                        <!-- 3D Preview Panel -->
                        <div class="panel-accordion-item" data-panel="preview3d">
                            <div class="panel-accordion-header" data-panel="preview3d">
                                <i class="fas fa-cube"></i>
                                <span>3D Preview</span>
                                <i class="fas fa-chevron-down accordion-chevron"></i>
                            </div>
                            <div class="panel-accordion-content" id="preview3dPanel">
                                <!-- Content will be rendered by Preview3DPanel -->
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>

        <!-- Command Palette -->
        <div class="command-palette">
            <div class="command-input-container">
                <span class="command-prompt">Command:</span>
                <input type="text" id="commandInput" class="command-input" placeholder="Type a command...">
                <div class="command-suggestions" id="commandSuggestions"></div>
            </div>
            <div class="command-status">
                <span id="commandStatus">Ready</span>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-left">
                <div class="status-item">
                    <span class="status-label">Coordinates:</span>
                    <span id="mouseCoordinates">0, 0</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Selected:</span>
                    <span id="selectedCount">0</span>
                </div>
            </div>
            
            <div class="status-right">
                <div class="status-item">
                    <span class="status-label">Zoom:</span>
                    <span id="zoom-level">100%</span>
                </div>
                <div class="status-toggle" id="gridStatus">
                    <i class="fas fa-th"></i>
                    <span>GRID</span>
                </div>
                <div class="status-toggle" id="snapStatus">
                    <i class="fas fa-magnet"></i>
                    <span>SNAP</span>
                </div>
                <div class="status-toggle" id="orthoStatus">
                    <i class="fas fa-square"></i>
                    <span>ORTHO</span>
                </div>
            </div>
        </div>

        <!-- Modals -->
        <div id="settingsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Settings</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <h3>Interface Settings</h3>
                    <p>Configure your CAD interface preferences:</p>
                    <div class="settings-info">
                        <div class="info-item">
                            <strong>Keyboard Shortcuts:</strong>
                            <ul>
                                <li><strong>S:</strong> Select tool</li>
                                <li><strong>L:</strong> Light tool</li>
                                <li><strong>R:</strong> Room tool</li>
                                <li><strong>Delete:</strong> Delete selected objects</li>
                                <li><strong>Ctrl+S:</strong> Save layout</li>
                                <li><strong>Ctrl+O:</strong> Load layout</li>
                                <li><strong>Space:</strong> Pan view</li>
                                <li><strong>Scroll:</strong> Zoom in/out</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notification History Panel -->
        <div id="notificationPanel" class="notification-panel" style="display: none;">
            <div class="notification-header">
                <h3><i class="fas fa-bell"></i> Notification History</h3>
                <div class="notification-actions">
                    <button class="notification-btn" id="clearNotifications" title="Clear All">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button class="notification-btn" id="closeNotifications" title="Close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="notification-body" id="notificationHistory">
                <div class="notification-empty">
                    <i class="fas fa-bell-slash"></i>
                    <p>No notifications yet</p>
                </div>
            </div>
        </div>

        <!-- Status Messages -->
        <div id="statusMessages" class="status-messages"></div>
    </div>

    <!-- Scripts -->
    <script src="js/fabric.min.js"></script>
    <script src="js/HAWebSocketClient.js"></script>
    
    <!-- Three.js from CDN - Load before app.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.148.0/build/three.min.js"></script>
    <script>
        // Verify Three.js loaded
        if (typeof THREE !== 'undefined') {
            console.log('✅ Three.js loaded successfully, version:', THREE.REVISION);
        } else {
            console.error('❌ Three.js failed to load from CDN');
            // Try fallback
            document.write('<script src="https://unpkg.com/three@0.148.0/build/three.min.js"><\/script>');
        }
    </script>
    <!-- OrbitControls, GLTFExporter and OBJLoader from local files -->
    <script src="js/three/OrbitControls-legacy.js"></script>
    <script src="js/three/GLTFExporter-legacy.js"></script>
    <script src="js/three/OBJLoader-legacy.js"></script>
    <script src="js/Blueprint3DAdapter.js" onerror="console.error('❌ Failed to load Blueprint3DAdapter.js:', event)"></script>
    <script>
        // Verify Blueprint3DAdapter loaded
        setTimeout(() => {
            if (typeof Blueprint3DAdapter !== 'undefined') {
                console.log('✅ Blueprint3DAdapter loaded successfully');
            } else {
                console.error('❌ Blueprint3DAdapter not found after load attempt');
                // Check if THREE is available
                if (typeof THREE === 'undefined') {
                    console.error('❌ THREE.js is also not available - CDN might be blocked');
                }
            }
        }, 100);
    </script>
    
    <!-- Load app.js after Three.js -->
    <script src="js/app.js"></script>
    
    <!-- Load Footer Component -->
    <script type="module" src="js/components/FooterComponent.js"></script>
    
    <!-- Load Settings Bar Component -->
    <script type="module" src="js/components/SettingsBarComponent.js"></script>
    
    <script type="module">
        // Import and initialize the panel system
        import { PanelManager } from './js/panels/PanelManager.js';
        import { CanvasPanel } from './js/panels/CanvasPanel.js';
        import { LightsPanel } from './js/panels/LightsPanel.js';
        import { ScenesPanel } from './js/panels/ScenesPanel.js';
        import { EntitiesPanel } from './js/panels/EntitiesPanel.js';
        import { PropertiesPanel } from './js/panels/PropertiesPanel.js';
        import { SceneEditorPanel } from './js/panels/SceneEditorPanel.js';
        import { LayersPanel } from './js/panels/LayersPanel.js';
        import { DebugPanel } from './js/panels/DebugPanel.js';
        import { Preview3DPanel } from './js/panels/Preview3DPanel.js';
        
        // Initialize panel system after app.js loads
        window.addEventListener('load', () => {
            // Make PanelManager globally available
            window.panelManager = new PanelManager();
            
            // Register all panels
            window.panelManager.register(new CanvasPanel());
            window.panelManager.register(new LightsPanel());
            window.panelManager.register(new ScenesPanel());
            window.panelManager.register(new EntitiesPanel());
            window.panelManager.register(new PropertiesPanel());
            window.panelManager.register(new SceneEditorPanel());
            window.panelManager.register(new LayersPanel());
            window.panelManager.register(new DebugPanel());
            window.panelManager.register(new Preview3DPanel());
            
            // Initialize panels
            window.panelManager.init();
            
            // Debug: Check what loaded after initialization
            setTimeout(() => {
                console.log('🔍 Debug check after 2 seconds:');
                console.log('   THREE available:', typeof THREE !== 'undefined');
                console.log('   Blueprint3DAdapter available:', typeof Blueprint3DAdapter !== 'undefined');
                console.log('   PanelManager available:', window.panelManager !== undefined);
                console.log('   Preview3D Panel:', window.panelManager?.getPanel('preview3d'));
            }, 2000);
        });
    </script>
</body>
</html>